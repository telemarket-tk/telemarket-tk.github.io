{% if include.star %}
  {% assign condition = "item.singer contains " | append: 'include.star' %}
{% else %}
	{% assign condition = "item.singer" %}
{% endif %}
{% assign sorted = site.data.audio | where_exp: "item", condition | sort: 'date' | reverse %}

<div class="player-container">
	<header>
		<h4 id="title">{{ sorted[0].name }}</h4>
		<p id="meta">{{ sorted[0].singer }}, {{ sorted[0].date }}</p>
	</header>
	<audio id="audio" preload="auto" tabindex="0" controls="" >
	  <source src="http://a.clyp.it/{{ sorted[0].id }}.mp3">
	  Your browser does not support the <code>audio</code> element.
	</audio>

	<ul id="playlist">
	{% for song in sorted %}
	<li{% if forloop.index0 == 0 %} class="active"{% endif %}><a href="http://a.clyp.it/{{ song.id }}.mp3"><h4>{{ song.name }}</h4></a><p>{{ song.singer }}, {{ song.date }}</p></li>
	{% endfor %}
	</ul>
</div>

<style media="screen">
	.player-container{padding:20px;}
	.active a{color:black;}
	ul li {display:block;padding:5px;margin-bottom:0}
	/*#playlist,audio{width:400px;}*/
	#title{font-weight: bold;margin-bottom: 0;}
	.player-container header{margin-left: 30px;color: grey;}
</style>
<script type="text/javascript">
init();
function init(){
	var current = 0;
	var audio = $('#audio');
	var playlist = $('#playlist');
	var tracks = playlist.find('li a');
	var len = tracks.length - 1;
	audio[0].volume = .10;
	// audio[0].play();
	playlist.find('a').click(function(e){
			e.preventDefault();
			link = $(this);
			current = link.parent().index();
			run(link, audio[0]);
	});
	audio[0].addEventListener('ended',function(e){
			current++;
			if(current == len){
					current = 0;
					link = playlist.find('a')[0];
			}else{
					link = playlist.find('a')[current];
			}
			run($(link),audio[0]);
	});
}
function run(link, player){
			player.src = link.attr('href');
			par = link.parent();
			par.addClass('active').siblings().removeClass('active');
			player.load();
			player.play();
			$('#title').html(link.text());
}
</script>
